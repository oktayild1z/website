<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portföy</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Portföy</h1>
  <div id="portfolio"></div>

  <script>
    // Görsel fallback fonksiyonu
    function imgOf(it) {
      return (it.image_url && it.image_url.startsWith("http"))
        ? it.image_url
        : "assets/no-image.jpg";
    }

    // Kart render fonksiyonu
    function render(items) {
      const container = document.getElementById("portfolio");
      container.innerHTML = items.map(it => `
        <div class="card">
          <img src="${imgOf(it)}" alt="${it.title || ''}" 
               onerror="this.onerror=null;this.src='assets/no-image.jpg'">
          <h3>${it.title || ''}</h3>
          <p><strong>Fiyat:</strong> ${it.price || ''}</p>
          <p><strong>m²:</strong> ${it.m2 || ''}</p>
          <p><strong>Oda:</strong> ${it.rooms || ''}</p>
          <p><strong>İlçe:</strong> ${it.district || ''}</p>
          <p><strong>Durum:</strong> ${it.status || ''}</p>
          ${it.link ? `<a href="${it.link}" target="_blank">İlana Git</a>` : ""}
        </div>
      `).join("");
    }

    // JSON’u Netlify function’dan çek
    async function load() {
      try {
        const res = await fetch("/.netlify/functions/portfolio", { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        window._DATA = data;   // filtre/sıralama için global
        render(data);
      } catch (err) {
        console.error("Veri çekilemedi:", err);
        document.getElementById("portfolio").innerHTML = "<p>Veri yüklenemedi.</p>";
      }
    }

    load();
  </script>
</body>
</html>
